@model Minible5.Models.ViewModels.TiposMovimientos.EditTiposMovimientosViewModels

@{
    ViewBag.Title = "Editar Tipos de Movimientos";
    ViewBag.pTitle = "Editar Tipos de Movimientos";
    ViewBag.pageTitle = "Tipos de Movimientos";
    Layout = "~/Views/_Shared/_Layout.cshtml";

    List<SelectListItem> itemsTipocliente = (List<SelectListItem>)ViewBag.itemsTipocliente;

}

<!-- plugin css -->
<link href="~/assets/libs/select2/css/select2.min.css" rel="stylesheet" type="text/css" />

<!-- Sweet Alert-->
<link href="~/assets/libs/sweetalert2/sweetalert2.min.css" rel="stylesheet" type="text/css" />
<!-- dropzone css -->
<link href="~/assets/libs/dropzone/min/dropzone.min.css" rel="stylesheet" type="text/css" />



<!-- Font Awesome -->
<link rel="stylesheet" href="~/assets/LTE/bower_components/font-awesome/css/font-awesome.min.css">

<!-- daterange picker -->
<link rel="stylesheet" href="~/assets/LTE/bower_components/bootstrap-daterangepicker/daterangepicker.css">

<!-- bootstrap datepicker -->
<link rel="stylesheet" href="~/assets/LTE/bower_components/bootstrap-datepicker/dist/css/bootstrap-datepicker.min.css">

<!-- iCheck for checkboxes and radio inputs -->
<link rel="stylesheet" href="~/assets/LTE/plugins/iCheck/all.css">

<!-- Bootstrap time Picker -->
<link rel="stylesheet" href="~/assets/LTE/plugins/timepicker/bootstrap-timepicker.min.css">

<!-- Theme style -->
<link rel="stylesheet" href="~/assets/LTE/dist/css/AdminLTE.min.css">

@using (Html.BeginForm("Edit", "tiposmovimientosinvs", FormMethod.Post, new { role = "form", @class = "needs-validation ", Novalidate = true }))
{
    <div class="row">
        <div class="col-lg-12">
            <div class="card">
                <div class="p-4 border-top">


                    <div class="box box-primary">
                        <div class="box-header with-border">
                            <h3 class="box-title">Encabezado</h3>

                            <div class="box-tools pull-right">
                                <button type="button" class="btn btn-box-tool" data-widget="collapse"><i class="fa fa-minus"></i></button>
                                <button type="button" class="btn btn-box-tool" data-widget="remove"><i class="fa fa-remove"></i></button>
                            </div>
                        </div>
                        <div class="box-body">

                            @Html.HiddenFor(d => d.idInternoTiposMovimientos)
                            <div class="text-danger mb-3 row">
                                @Html.ValidationSummary(false)
                            </div>

                            <div class="row">
                                <div class="col-md-6">
                                    <div class="form-group">
                                        @Html.LabelFor(d => d.IdTipoMovimiento)
                                        <div class="has-validation">
                                            @Html.TextBoxFor(d => d.IdTipoMovimiento, new { @class = "form-control", placeholder = "Codigo Tipo de Movimiento", Required = true })
                                            <div class="invalid-feedback">
                                                Porfavor, Ingresar el codigo del tipo de movimiento.
                                            </div>
                                        </div>

                                    </div>
                                </div>
                                <!-- /.col -->
                                <div class="col-md-6">
                                    <div class="form-group">
                                        @Html.LabelFor(d => d.poliza)
                                        <div class="has-validation">
                                            @Html.TextBoxFor(d => d.poliza, new { @class = "form-control", placeholder = "Poliza", Required = true })
                                            <div class="invalid-feedback">
                                                Porfavor, Ingresar la Poliza.
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                <!-- /.col -->
                            </div>
                            <!-- /.row -->

                            <br />
                            <div class="row">
                                <div class="col-md-12">
                                    <div class="form-group">
                                        @Html.LabelFor(d => d.Descripcion)
                                        <div class="has-validation">
                                            @Html.TextBoxFor(d => d.Descripcion, new { @class = "form-control", placeholder = "Descripcion", Required = true })
                                            <div class="invalid-feedback">
                                                Porfavor, Ingresar la Descripcion.
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                <!-- /.col -->
                            </div>
                            <!-- /.row -->

                            <br />
                            <div class="row">
                                <div class="col-md-6">
                                    <div class="form-group">
                                        @Html.RadioButtonFor(d => d.entradaSalida, "E", new { @class = "flat-red" })
                                        @Html.Label("entrada", "Entrada", new { @class = "form-check-label" })
                                        &nbsp; &nbsp; &nbsp;
                                        @Html.RadioButtonFor(d => d.entradaSalida, "S", new { @class = "flat-red" })
                                        @Html.Label("salida", "Salida", new { @class = "form-check-label" })
                                    </div>
                                </div>
                                <!-- /.col -->
                                <div class="col-md-6">
                                    <div class="form-group">

                                        @Html.RadioButtonFor(d => d.facturacionInventario, "F", new { @class = "flat-red" })
                                        @Html.Label("facturacion", "Facturacion", new { @class = "form-check-label" })
                                        &nbsp; &nbsp; &nbsp;
                                        @Html.RadioButtonFor(d => d.facturacionInventario, "I", new { @class = "flat-red" })
                                        @Html.Label("inventario", "Inventario", new { @class = "form-check-label" })
                                    </div>
                                </div>
                                <!-- /.col -->
                            </div>
                            <!-- /.row -->

                            <br />
                            <div class="row">
                                <div class="col-md-6">
                                    <div class="form-group">
                                        @Html.CheckBoxFor(d => d.afectaCostoPromedio, new { @class = "flat-red" })
                                        @Html.LabelFor(d => d.afectaCostoPromedio, new { @class = "col-form-label" })
                                    </div>
                                </div>
                                <!-- /.col -->
                                <div class="col-md-6">
                                    <div class="form-group">
                                        @Html.CheckBoxFor(d => d.afectaCostoRepocicion, new { @class = "flat-red" })
                                        @Html.LabelFor(d => d.afectaCostoRepocicion, new { @class = "col-form-label" })
                                    </div>
                                </div>
                                <!-- /.col -->
                            </div>
                            <!-- /.row -->

                            <div class="row">
                                <div class="col-md-6">
                                    <div class="form-group">
                                        @Html.CheckBoxFor(d => d.afectaestadisticacompra, new { @class = "flat-red" })
                                        @Html.LabelFor(d => d.afectaestadisticacompra, new { @class = "col-form-label" })
                                    </div>
                                </div>
                                <!-- /.col -->
                                <div class="col-md-6">
                                    <div class="form-group">
                                        @Html.CheckBoxFor(d => d.afectaestadisticaventa, new { @class = "flat-red" })
                                        @Html.LabelFor(d => d.afectaestadisticaventa, new { @class = "col-form-label" })
                                    </div>
                                </div>
                                <!-- /.col -->
                            </div>
                            <!-- /.row -->

                            <div class="row">
                                <div class="col-md-6">
                                    <div class="form-group">
                                        @Html.CheckBoxFor(d => d.afectaCostoUCompra, new { @class = "flat-red" })
                                        @Html.LabelFor(d => d.afectaCostoUCompra, new { @class = "col-form-label" })
                                    </div>
                                </div>
                                <!-- /.col -->
                            </div>
                            <!-- /.row -->

                            <br />
                            <div class="row">
                                <div class="col-md-6">
                                    <div class="form-group">
                                        @Html.RadioButtonFor(d => d.clienteProveedor, "C", new { @class = "flat-red" })
                                        @Html.Label("cliente", "Cliente", new { @class = "form-check-label" })
                                        &nbsp; &nbsp; &nbsp;
                                        @Html.RadioButtonFor(d => d.clienteProveedor, "P", new { @class = "flat-red" })
                                        @Html.Label("proveedor", "Proveedor", new { @class = "form-check-label" })
                                        &nbsp; &nbsp; &nbsp;
                                        @Html.RadioButtonFor(d => d.clienteProveedor, "I", new { @class = "flat-red" })
                                        @Html.Label("interno", "Interno", new { @class = "form-check-label" })
                                    </div>
                                </div>
                                <!-- /.col -->
                            </div>
                            <!-- /.row -->

                        </div>
                        <!-- /.box-body -->
                    </div>
                    <!-- /.box -->

                    <br />
                    <div class="box box-success">
                        <div class="box-header with-border">
                            <h3 class="box-title">Detalle</h3>
                            <div class="box-tools pull-right">
                                <button type="button" class="btn btn-box-tool" data-widget="collapse"><i class="fa fa-minus"></i></button>
                                <button type="button" class="btn btn-box-tool" data-widget="remove"><i class="fa fa-remove"></i></button>
                            </div>
                        </div>

                        <div class="box-body" id="divConceptosEditPadre">
                            @for (int i = 0; i < Model.contador; i++)
                            {
                                <div id="@("divConceptosEdit"+i )">
                                    @Html.HiddenFor(d => d.conceptosEdit[i].idInternoTiposMovimientos)
                                    @Html.HiddenFor(d => d.conceptosEdit[i].idInternoTIposMovimientosSeries)

                                    <div class="row">
                                        <div class="col-md-6">
                                            <div class="form-group">
                                                @Html.LabelFor(d => d.conceptosEdit[i].idSerie, new { @class = "col-form-label" })
                                                <div class="has-validation">
                                                    @Html.TextBoxFor(d => d.conceptosEdit[i].idSerie, new { @class = "form-control" })
                                                    <div class="invalid-feedback">
                                                        Porfavor, Ingresar la serie.
                                                    </div>
                                                </div>

                                            </div>
                                        </div>
                                        <!-- /.col -->
                                        <div class="col-md-6">
                                            <div class="form-group">
                                                @Html.LabelFor(d => d.conceptosEdit[i].secuencia, new { @class = "col-form-label" })
                                                <div class="has-validation">
                                                    @Html.TextBoxFor(d => d.conceptosEdit[i].secuencia, new { @class = "form-control" })
                                                    <div class="invalid-feedback">
                                                        Porfavor, Ingresar la Secuencia.
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                        <!-- /.col -->
                                    </div>
                                    <!-- /.row -->

                                    <div class="row">
                                        <div class="col-md-6">
                                            <div class="form-group">
                                                @Html.LabelFor(d => d.conceptosEdit[i].correlativo, new { @class = "col-form-label" })
                                                <div class="has-validation">
                                                    @Html.TextBoxFor(d => d.conceptosEdit[i].correlativo, new { @class = "form-control" })
                                                    <div class="invalid-feedback">
                                                        Porfavor, Ingresar el correlativo.
                                                    </div>
                                                </div>

                                            </div>
                                        </div>
                                        <!-- /.col -->
                                        <div class="col-md-6">
                                            <div class="form-group">
                                                @Html.LabelFor(d => d.conceptosEdit[i].formatoImpresion, new { @class = "col-form-label" })
                                                @Html.TextBoxFor(d => d.conceptosEdit[i].formatoImpresion, new { @class = "form-control" })
                                            </div>
                                        </div>
                                        <!-- /.col -->
                                    </div>
                                    <!-- /.row -->

                                    <div class="row">
                                        <div class="col-md-6">
                                            <div class="form-group">
                                                @Html.LabelFor(d => d.conceptosEdit[i].resolucionNumero, new { @class = "col-form-label" })
                                                @Html.TextBoxFor(d => d.conceptosEdit[i].resolucionNumero, new { @class = "form-control" })
                                            </div>
                                        </div>
                                        <!-- /.col -->
                                        <div class="col-md-6">
                                            <div class="form-group">
                                                @Html.LabelFor(d => d.conceptosEdit[i].fechaAutorizacion, new { @class = "col-form-label" })
                                                @Html.TextBoxFor(d => d.conceptosEdit[i].fechaAutorizacion, new { @class = "form-control" })
                                            </div>
                                        </div>
                                        <!-- /.col -->
                                    </div>
                                    <!-- /.row -->

                                    <div class="row">
                                        <div class="col-md-6">
                                            <div class="form-group">
                                                @Html.LabelFor(d => d.conceptosEdit[i].res_del, new { @class = "col-form-label" })
                                                @Html.TextBoxFor(d => d.conceptosEdit[i].res_del, new { @class = "form-control" })
                                            </div>
                                        </div>
                                        <!-- /.col -->
                                        <div class="col-md-6">
                                            <div class="form-group">
                                                @Html.LabelFor(d => d.conceptosEdit[i].res_al, new { @class = "col-form-label" })
                                                @Html.TextBoxFor(d => d.conceptosEdit[i].res_al, new { @class = "form-control" })
                                            </div>
                                        </div>
                                        <!-- /.col -->
                                    </div>
                                    <!-- /.row -->

                                    <a id="@("buttonDelete"+i)" href="javascript:void(0);" onclick="@("EliminarConcepto("+i )@(")")" class="px-3 text-danger">Eliminar Esta Serie<i class="uil uil-trash-alt font-size-24"></i></a>

                                </div>
                            }
                            <input type="hidden" id="idItemUltimoELiminado" value=-1 />
                            <input type="hidden" id="idContador" value=0 />
                            <input type="hidden" id="idIteracion" value=@Model.contador />

                            <br />
                            <div class="row">
                                <button type="button" class="btn btn-secondary btn-block" onclick="AgregaConcepto(); return false;">Agregar Nueva Serie</button>
                            </div>
                            <!-- /.row -->

                            <div id="divConceptos">

                            </div>
                            <!-- /.Conceptos -->

                            <div id="divConceptosDelete">

                            </div>

                        </div>
                        <!-- /.box-body -->
                    </div>
                    <!-- /.box -->



                </div>
            </div>
        </div>
    </div>
    <!-- end row -->


    <div id="hiddenEmpresas"></div>

    <div class="row mb-4">
        <div class="col text-end">
            <a href="@Url.Action("Index", "tiposmovimientosinvs")" class="btn btn-danger"> <i class="uil uil-times me-1"></i> Cancelar </a>
            <button type="submit" class="btn btn-success"> <i class="uil uil-file-alt me-1"></i> Guardar </button>
        </div> <!-- end col -->
    </div> <!-- end row-->
}

<!-- JAVASCRIPT -->

<script src="~/assets/js/AddConceptos.js"></script>
<script src="~/assets/js/DeleteConceptos.js"></script>

<script src="~/assets/libs/jquery/jquery.min.js"></script>
<script src="~/assets/libs/bootstrap/js/bootstrap.bundle.min.js"></script>
<script src="~/assets/libs/metismenu/metisMenu.min.js"></script>
<script src="~/assets/libs/simplebar/simplebar.min.js"></script>
<script src="~/assets/libs/node-waves/waves.min.js"></script>
<script src="~/assets/libs/waypoints/lib/jquery.waypoints.min.js"></script>
<script src="~/assets/libs/jquery.counterup/jquery.counterup.min.js"></script>

<script src="~/assets/js/pages/form-validation.init.js"></script>
<script src="~/assets/libs/parsleyjs/parsley.min.js"></script>

<!-- Responsive examples -->
<script src="~/assets/libs/datatables.net-responsive/js/dataTables.responsive.min.js"></script>
<script src="~/assets/libs/datatables.net-responsive-bs4/js/responsive.bootstrap4.min.js"></script>



<!-- Sweet Alerts js -->
<script src="~/assets/libs/sweetalert2/sweetalert2.min.js"></script>

<!-- Table Editable plugin -->
<script src="~/assets/libs/table-edits/build/table-edits.min.js"></script>
<script src="~/assets/js/pages/table-editable.int.js"></script>

<!-- dropzone plugin -->
<script src="~/assets/libs/dropzone/min/dropzone.min.js"></script>

<!-- init js -->
<script src="~/assets/js/pages/ecommerce-add-product.init.js"></script>

<script src="~/assets/js/app.js"></script>



<!-- jQuery 3 -->
<script src="~/assets/LTE/bower_components/jquery/dist/jquery.min.js"></script>
<!-- Bootstrap 3.3.7 -->
<script src="~/assets/LTE/bower_components/bootstrap/dist/js/bootstrap.min.js"></script>
<!-- Select2 -->
<script src="~/assets/LTE/bower_components/select2/dist/js/select2.full.min.js"></script>
<!-- InputMask -->
<script src="~/assets/LTE/plugins/input-mask/jquery.inputmask.js"></script>
<script src="~/assets/LTE/plugins/input-mask/jquery.inputmask.date.extensions.js"></script>
<script src="~/assets/LTE/plugins/input-mask/jquery.inputmask.extensions.js"></script>
<!-- date-range-picker -->
<script src="~/assets/LTE/bower_components/moment/min/moment.min.js"></script>
<script src="~/assets/LTE/bower_components/bootstrap-daterangepicker/daterangepicker.js"></script>
<!-- bootstrap datepicker -->
<script src="~/assets/LTE/bower_components/bootstrap-datepicker/dist/js/bootstrap-datepicker.min.js"></script>

<!-- bootstrap time picker -->
<script src="~/assets/LTE/plugins/timepicker/bootstrap-timepicker.min.js"></script>
<!-- SlimScroll -->
<!-- iCheck 1.0.1 -->
<script src="~/assets/LTE/plugins/iCheck/icheck.min.js"></script>
<!-- FastClick -->
<!-- AdminLTE App -->
<script src="~/assets/LTE/dist/js/adminlte.min.js"></script>
<!-- AdminLTE for demo purposes -->

<script>
    var num = 0;
    var numAdd = 0;

    $(function () {
        //Date picker
        $('#datepicker').datepicker({
            autoclose: true
        })

        //iCheck for checkbox and radio inputs
        $('input[type="checkbox"].minimal, input[type="radio"].minimal').iCheck({
            checkboxClass: 'icheckbox_minimal-blue',
            radioClass: 'iradio_minimal-blue'
        })
        //Red color scheme for iCheck
        $('input[type="checkbox"].minimal-red, input[type="radio"].minimal-red').iCheck({
            checkboxClass: 'icheckbox_minimal-red',
            radioClass: 'iradio_minimal-red'
        })
        //Flat red color scheme for iCheck
        $('input[type="checkbox"].flat-red, input[type="radio"].flat-red').iCheck({
            checkboxClass: 'icheckbox_flat-green',
            radioClass: 'iradio_flat-green'
        })

    });

    function AgregaConcepto() {
        let divConceptos = document.getElementById("divConceptos");

        CrearConceptos(numAdd, 2, "idSerie", "idSerie", "text", "idSerielb", "Codigo Serie", "secuencia", "idSecuencia", "text", "idSecuencialb", "Secuencia");
        CrearConceptos(numAdd, 2, "correlativo", "idCorrelativo", "text", "idCorrelativolb", "Correlativo", "formatoImpresion", "idformatoImpresion", "text", "idFormatolb", "Formato de Impresion");
        CrearConceptos(numAdd, 2, "resolucionNumero", "idResolucion", "text", "idResolucionlb", "Resolucion", "fechaAutorizacion", "idFechaAu", "date", "idfechalb", "Fecha de Autorizacion");
        CrearConceptos(numAdd, 2, "res_del", "idResDel", "text", "idResdelb", "Del", "res_al", "idResAl", "text", "idResAlb", "Al");
        CrearConceptos(numAdd, 1, "usaCorrelativo", "idUsa", "checkbox", "idUsalb", "Automatico &nbsp; ");

        let lhr = document.createElement("hr");
        lhr.style.height = "4px";
        lhr.style.backgroundColor = "#B8BBBB";
        lhr.style.border = "none";
        lhr.style.marginTop = "2rem";
        lhr.style.marginBottom = "2rem";

        let HiddenIndex = document.createElement("input");
        HiddenIndex.name = "conceptos.Index";
        HiddenIndex.value = numAdd;
        HiddenIndex.type = "hidden";

        divConceptos.appendChild(HiddenIndex);
        divConceptos.appendChild(lhr);


        numAdd++;
    }


    function EliminarConcepto(id) {

        Swal.fire({
            title: "Estas seguro?", text: "No hay forma de rehacer esta función!", icon: "warning", showCancelButton: !0, confirmButtonText: "Si, Eliminar!", cancelButtonText: "No, Cancelar!", confirmButtonClass: "btn btn-success mt-2", cancelButtonClass: "btn btn-danger ms-2 mt-2", buttonsStyling: !1
        }).then(async function (t) {
            if (t.value) {

                //Hacemos una lista de campos ocultos que se eliminaran
                let DivConceptos = document.getElementById("divConceptosDelete");
                let HiddenIdInterno = document.createElement("input");
                let idHtmlInterno = "conceptosEdit_" + id + "__idInternoTIposMovimientosSeries";

                //obtenemos los valores del contador y el id del item a eliminar
                let num = document.getElementById("idContador").value;
                let IdModelInterno = document.getElementById(idHtmlInterno).value;

                HiddenIdInterno.name = "conceptosDelete[" + num + "].idInternoTIposMovimientosSeries";
                HiddenIdInterno.value = IdModelInterno;
                HiddenIdInterno.type = "hidden";

                DivConceptos.appendChild(HiddenIdInterno);

                Delete(id, "__idInternoTIposMovimientosSeries", "idInternoTIposMovimientosSeries", "N");
                Delete(id, "__idInternoTiposMovimientos", "idInternoTiposMovimientos", "N");
                Delete(id, "__idSerie", "idSerie", "N");
                Delete(id, "__correlativo", "correlativo", "N");
                Delete(id, "__formatoImpresion", "formatoImpresion", "N");
                Delete(id, "__fechaAutorizacion", "fechaAutorizacion", "N");
                Delete(id, "__res_del", "res_del", "N");
                Delete(id, "__res_al", "res_al", "N");
                Delete(id, "__resolucionNumero", "resolucionNumero", "N");
                Delete(id, "__secuencia", "secuencia", "S");

                Swal.fire({ title: "Eliminado!", text: "El Tipo de movimiento ha sido eliminado.", icon: "success" })
            } else {
                //SI CANCELA
                t.dismiss === Swal.DismissReason.cancel && Swal.fire({ title: "Cancelado", text: "El Tipo de movimiento no se ha eliminado :)", icon: "error" })
            }
        })

    }


</script>

